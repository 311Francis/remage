import os
import subprocess
import setuptools_scm


def configure_doxyfile(input_dir, output_dir):
    with open("../Doxyfile.in", "r") as file:
        filedata = file.read()

    filedata = filedata.replace("@DOXYGEN_INPUT_DIR@", input_dir)
    filedata = filedata.replace("@DOXYGEN_OUTPUT_DIR@", output_dir)

    with open("../Doxyfile", "w") as file:
        file.write(filedata)


project = "remage"
copyright = "2020, the LEGEND Collaboration"
author = "Luigi Pertoldi"

extensions = [
    "sphinx.ext.mathjax",
    "sphinx.ext.intersphinx",
    "sphinx_copybutton",
    "sphinx_inline_tabs",
    "breathe",
    "myst_parser",
]

breathe_default_project = "remage"
highlight_language = "c++"
html_logo = "../../.github/logo/remage-logo.png"

on_rtd = os.environ.get("READTHEDOCS", None) == "True"

breathe_projects = {}

if on_rtd:
    input_dir = ".."
    output_dir = "build"
    configure_doxyfile(input_dir, output_dir)
    subprocess.call("cd ..; doxygen", shell=True)
    breathe_projects["remage"] = f"../{output_dir}/xml"
    version = setuptools_scm.get_version("../..")
else:
    breathe_projects["remage"] = "../xml"
    version = "@PROJECT_VERSION@"

# Furo theme
html_theme = "furo"
html_theme_options = {
    "source_repository": "https://github.com/legend-exp/remage",
    "source_branch": "main",
    "source_directory": "docs/source",
}
html_title = f"{project} {version}"
